name: 自动部署

on:
  push:
    branches:
      - master
  release:
    types:
      - published

jobs:
  deploy:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    concurrency:
      group: ${{ github.workflow }}-${{ github.ref }}

    steps:
      - name: Set Timezone
        run: export TZ='Asia/Shanghai'

      - name: 检查分支
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: 安装 Node
        uses: actions/setup-node@v4
        with:
          node-version: "22.x"
          # 注意：这里去掉了 cache: 'yarn'，为了避免版本冲突报错
          # 如果需要缓存 Yarn 4，通常需要手动配置 actions/cache，但为了先跑通，暂时去掉

      - name: 启用 Corepack (激活 Yarn 4)
        run: corepack enable

      - name: 安装依赖
        run: |
          yarn global add gulp-cli
          # --frozen-lockfile 确保使用 yarn.lock 中的精确版本
          # 如果这一步报错，说明本地 yarn.lock 和远程环境不兼容，